// staff.html の script 部分を差し替え
    function onYouTubeIframeAPIReady() {
        player = new YT.Player('player', {
            height: '360', width: '640',
            playerVars: { 'origin': location.origin },
            events: { 
                'onStateChange': (e) => {
                    // 1:再生中, 2:一時停止, 0:終了
                    db.ref('sync/state').set(e.data);
                    db.ref('sync/time').set(player.getCurrentTime());
                } 
            }
        });
    }

    // 0.5秒おきの同期に「停止状態」の送信も追加
    setInterval(() => {
        if(player && typeof player.getPlayerState === 'function') {
            const state = player.getPlayerState();
            db.ref('sync/state').set(state); // 常に最新の状態を報告
            if(state === 1) {
                db.ref('sync/time').set(player.getCurrentTime());
            }
        }
    }, 500);
