<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>27 Club - Staff Cockpit</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;900&display=swap" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
    <style>
        :root { --red: #ff0033; --border: #333; }
        body, html { margin: 0; padding: 0; height: 100vh; background: #000; color: #fff; font-family: 'Orbitron', sans-serif; overflow: hidden; }
        
        .container { display: flex; width: 100vw; height: 100vh; }

        /* 左パネル：操作・動画・画像投稿（幅40%） */
        .left-side { width: 400px; padding: 25px; border-right: 1px solid var(--border); display: flex; flex-direction: column; gap: 20px; background: #0a0a0a; box-sizing: border-box; overflow-y: auto; }
        .logo { font-size: 22px; font-weight: 900; letter-spacing: 3px; }
        .logo span { color: var(--red); }
        
        #player-wrapper { width: 100%; aspect-ratio: 16/9; background: #000; border: 1px solid var(--border); }
        #player { width: 100%; height: 100%; }

        .panel { background: #111; border: 1px solid var(--border); padding: 15px; border-radius: 4px; }
        .label { font-size: 10px; color: #888; margin-bottom: 10px; letter-spacing: 1px; }
        input { width: 100%; padding: 12px; background: #000; border: 1px solid #444; color: #fff; font-family: 'Orbitron'; font-size: 11px; margin-bottom: 10px; box-sizing: border-box; outline: none; }
        input:focus { border-color: var(--red); }
        
        .btn { width: 100%; padding: 15px; border: none; border-radius: 4px; font-family: 'Orbitron'; font-weight: 900; cursor: pointer; text-transform: uppercase; font-size: 11px; }
        .btn-red { background: var(--red); color: #fff; }
        .btn-gray { background: #333; color: #fff; margin-top: 5px; }

        /* 右パネル：予約リスト（残りすべて） */
        .right-side { flex-grow: 1; padding: 25px; background: #000; display: flex; flex-direction: column; box-sizing: border-box; }
        #reserve-list { flex-grow: 1; overflow-y: auto; }
        
        .list-item { background: #111; padding: 15px; margin-bottom: 12px; border-radius: 4px; display: flex; align-items: center; gap: 20px; border-left: 5px solid var(--red); }
        .list-item img { width: 100px; height: 56px; object-fit: cover; border-radius: 2px; }
        .list-info { flex-grow: 1; }
        .list-info b { color: #fff; font-size: 14px; display: block; margin-bottom: 5px; }
        
        .list-actions { display: flex; gap: 10px; }
        .play-btn { padding: 10px 20px; font-size: 11px; cursor: pointer; background: #222; border: 1px solid var(--red); color: var(--red); font-family: 'Orbitron'; font-weight: 900; border-radius: 3px; }
        .del-btn { padding: 10px; font-size: 11px; cursor: pointer; background: #222; border: 1px solid #444; color: #666; border-radius: 3px; }
    </style>
</head>
<body>

<div class="container">
    <div class="left-side">
        <div class="logo"><span>27</span> STAFF</div>
        
        <div id="player-wrapper">
            <div id="player"></div>
        </div>

        <div class="panel">
            <div class="label">ADD REQUEST</div>
            <input type="text" id="urlInput" placeholder="YOUTUBE URL">
            <input type="text" id="nameInput" placeholder="REQUESTER NAME">
            <button class="btn btn-red" onclick="addToQueue()">SUBMIT REQUEST</button>
        </div>

        <div class="panel">
            <div class="label">GALLERY POST</div>
            <input type="file" id="fileInput" style="display:none" onchange="uploadImage(this)">
            <button class="btn btn-gray" onclick="document.getElementById('fileInput').click()">SELECT & UPLOAD IMAGE</button>
        </div>
    </div>

    <div class="right-side">
        <div class="label" style="color:var(--red); font-weight:900; margin-bottom:15px;">RESERVATION QUEUE</div>
        <div id="reserve-list"></div>
    </div>
</div>

<script>
    // Firebase設定
    const firebaseConfig = {
        apiKey: "AIzaSyDoZtzHkOcC3p565fLN4oGO7vmlwQZiNkE",
        databaseURL: "https://club-d0011-default-rtdb.asia-southeast1.firebasedatabase.app",
        projectId: "club-d0011",
        appId: "1:51948793811:web:1edecab7c41c1d84ad8926"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    let player, currentVid = "";

    // YouTubeプレイヤーの準備
    function onYouTubeIframeAPIReady() {
        player = new YT.Player('player', {
            events: { 
                'onStateChange': (e) => {
                    if (currentVid) {
                        db.ref('sync').update({ 
                            state: e.data, 
                            time: player.getCurrentTime(), 
                            last: Date.now() 
                        });
                    }
                }
            }
        });
    }

    // 予約追加
    function addToQueue() {
        const u = document.getElementById('urlInput'), n = document.getElementById('nameInput');
        const vid = u.value.includes('v=') ? u.value.split('v=')[1].split('&')[0] : u.value.split('/').pop();
        if (vid.length < 5) return alert("URL Error");
        db.ref('queue').push({ vid: vid, name: n.value || "GUEST", time: Date.now() });
        u.value = ""; n.value = "";
    }

    // 予約リストの同期
    db.ref('queue').on('value', snap => {
        const list = document.getElementById('reserve-list');
        list.innerHTML = "";
        snap.forEach(child => {
            const d = child.val();
            const div = document.createElement('div');
            div.className = 'list-item';
            div.innerHTML = `
                <img src="https://img.youtube.com/vi/${d.vid}/mqdefault.jpg">
                <div class="list-info">
                    <b>${d.name.toUpperCase()}</b>
                </div>
                <div class="list-actions">
                    <button class="play-btn" onclick="playNow('${child.key}','${d.vid}','${d.name}')">PLAY NOW</button>
                    <button class="del-btn" onclick="db.ref('queue/${child.key}').remove()">✕</button>
                </div>`;
            list.appendChild(div);
        });
    });

    // 再生実行
    function playNow(key, vid, name) {
        currentVid = vid;
        player.loadVideoById(vid, 0);
        db.ref('sync').set({ vid: vid, name: name, state: 1, time: 0, last: Date.now() });
        db.ref('queue').child(key).remove();
    }

    // 画像投稿
    function uploadImage(input) {
        const file = input.files[0]; if(!file) return;
        const reader = new FileReader();
        reader.onload = (e) => {
            db.ref('gallery').push({ url: e.target.result, time: Date.now() });
            alert("Image Posted to Gallery");
        };
        reader.readAsDataURL(file);
    }

    const tag = document.createElement('script'); tag.src = "https://www.youtube.com/iframe_api"; document.body.appendChild(tag);
</script>
</body>
</html>
