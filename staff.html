<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>27 Club - Staff Cockpit</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;900&display=swap" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
    <style>
        :root { --red: #ff0033; --border: #333; }
        body { margin: 0; background: #000; color: #fff; font-family: 'Orbitron', sans-serif; display: flex; height: 100vh; overflow: hidden; }
        
        /* 左：操作パネル */
        .left { width: 380px; padding: 20px; border-right: 1px solid var(--border); display: flex; flex-direction: column; gap: 20px; }
        .logo { font-size: 20px; font-weight: 900; letter-spacing: 3px; }
        .logo span { color: var(--red); }
        .panel { background: #111; border: 1px solid var(--border); padding: 15px; border-radius: 4px; }
        .label { font-size: 10px; color: #888; margin-bottom: 8px; letter-spacing: 1px; }
        
        input { width: 100%; padding: 12px; background: #000; border: 1px solid #444; color: #fff; font-family: 'Orbitron'; font-size: 11px; margin-bottom: 10px; box-sizing: border-box; outline: none; }
        input:focus { border-color: var(--red); }
        .btn { width: 100%; padding: 15px; border: none; border-radius: 4px; font-family: 'Orbitron'; font-weight: 900; cursor: pointer; text-transform: uppercase; }
        .btn-red { background: var(--red); color: #fff; }
        .btn-gray { background: #333; color: #fff; height: 40px; font-size: 10px; margin-top: 5px; }

        /* 右：予約リスト */
        .right { flex-grow: 1; padding: 20px; background: #050505; display: flex; flex-direction: column; }
        .section-title { font-size: 10px; color: var(--red); margin-bottom: 15px; letter-spacing: 2px; font-weight: 900; }
        #reserve-list { flex-grow: 1; overflow-y: auto; }
        
        .list-item { background: #111; padding: 10px; margin-bottom: 8px; border-radius: 4px; display: flex; align-items: center; gap: 15px; border-left: 4px solid var(--red); }
        .list-item img { width: 90px; height: 50px; object-fit: cover; border-radius: 2px; }
        .list-info { flex-grow: 1; }
        .list-info b { color: #fff; font-size: 13px; display: block; margin-bottom: 2px; }
        .list-info span { color: #666; font-size: 10px; }
        .list-actions { display: flex; gap: 5px; }
        .mini-btn { padding: 8px 12px; font-size: 10px; cursor: pointer; background: #222; border: 1px solid #444; color: #fff; border-radius: 3px; font-family: 'Orbitron'; }
        .mini-btn:hover { background: #333; }
    </style>
</head>
<body>

<div class="left">
    <div class="logo"><span>27</span> STAFF</div>
    
    <div class="panel">
        <div class="label">ADD REQUEST</div>
        <input type="text" id="urlInput" placeholder="YOUTUBE URL...">
        <input type="text" id="nameInput" placeholder="REQUESTER NAME...">
        <button class="btn btn-red" onclick="addToQueue()">ADD TO QUEUE</button>
    </div>

    <div class="panel">
        <div class="label">GALLERY MANAGEMENT</div>
        <input type="file" id="fileInput" style="display:none" onchange="uploadImage(this)">
        <button class="btn btn-gray" onclick="document.getElementById('fileInput').click()">SELECT IMAGE</button>
        <div id="upStatus" style="font-size:9px; color:var(--red); text-align:center; margin-top:5px;"></div>
    </div>
</div>

<div class="right">
    <div class="section-title">RESERVATION QUEUE</div>
    <div id="reserve-list"></div>
</div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyDoZtzHkOcC3p565fLN4oGO7vmlwQZiNkE",
        databaseURL: "https://club-d0011-default-rtdb.asia-southeast1.firebasedatabase.app",
        projectId: "club-d0011",
        appId: "1:51948793811:web:1edecab7c41c1d84ad8926"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // 予約追加
    function addToQueue() {
        const urlInput = document.getElementById('urlInput');
        const nameInput = document.getElementById('nameInput');
        const url = urlInput.value;
        const name = nameInput.value || "GUEST";
        const vid = url.includes('v=') ? url.split('v=')[1].split('&')[0] : url.split('/').pop();

        if (vid.length < 5) return alert("URLが正しくありません");

        db.ref('queue').push({
            vid: vid,
            name: name,
            time: Date.now()
        }).then(() => {
            urlInput.value = "";
            nameInput.value = "";
        });
    }

    // リスト表示
    db.ref('queue').on('value', snap => {
        const list = document.getElementById('reserve-list');
        list.innerHTML = "";
        snap.forEach(child => {
            const data = child.val();
            const vid = data.vid || data.videoId;
            const name = data.name || data.requester || "GUEST";

            const div = document.createElement('div');
            div.className = 'list-item';
            div.innerHTML = `
                <img src="https://img.youtube.com/vi/${vid}/mqdefault.jpg">
                <div class="list-info">
                    <b>${name.toUpperCase()}</b>
                    <span>${vid}</span>
                </div>
                <div class="list-actions">
                    <button class="mini-btn" style="color:var(--red)" onclick="playNow('${child.key}','${vid}','${name}')">PLAY</button>
                    <button class="mini-btn" onclick="db.ref('queue/${child.key}').remove()">✕</button>
                </div>
            `;
            list.appendChild(div);
        });
    });

    // 再生指示
    function playNow(key, vid, name) {
        db.ref('sync').set({ vid: vid, name: name, state: 1, time: 0, last: Date.now() });
        db.ref('backnumbers').push({ vid: vid, name: name, time: Date.now() });
        db.ref('queue').child(key).remove();
    }

    // 画像アップロード
    function uploadImage(input) {
        const file = input.files[0]; if(!file) return;
        const reader = new FileReader();
        reader.onload = (e) => {
            db.ref('gallery').push({ url: e.target.result, time: Date.now() });
            document.getElementById('upStatus').innerText = "POST SUCCESS";
            setTimeout(() => { document.getElementById('upStatus').innerText = ""; }, 2000);
        };
        reader.readAsDataURL(file);
    }
</script>
</body>
</html>
