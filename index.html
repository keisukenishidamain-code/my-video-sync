<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>CLUB D-0011 - TOP</title>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
    <style>
        body { margin: 0; background: #0a0a0a; color: white; font-family: sans-serif; }
        header { background: #000; padding: 15px; border-bottom: 1px solid #333; display: flex; justify-content: space-between; align-items: center; }
        nav ul { display: flex; list-style: none; gap: 20px; margin: 0; }
        nav a { color: #888; text-decoration: none; cursor: pointer; }
        nav a:hover { color: #ff0000; }
        .section { display: none; padding: 20px; }
        .active { display: block; }
        #player-container { width: 100%; max-width: 800px; aspect-ratio: 16/9; margin: auto; background: #000; position: relative; }
        #player { width: 100%; height: 100%; }
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 20px; margin-top: 20px; }
        .card { background: #1a1a1a; border-radius: 8px; overflow: hidden; border: 1px solid #333; cursor: pointer; }
        .card:hover { border-color: #ff0000; }
        .card img { width: 100%; aspect-ratio: 16/9; object-fit: cover; }
        .card-info { padding: 10px; font-size: 13px; }
    </style>
</head>
<body>

<header>
    <div style="color:red; font-weight:bold;">CLUB D-0011</div>
    <nav>
        <ul>
            <li><a onclick="switchTab('top')">TOPページ</a></li>
            <li><a onclick="switchTab('backnumber')">バックナンバー</a></li>
        </ul>
    </nav>
</header>

<div id="top" class="section active">
    <div id="player-container"><div id="player"></div></div>
    <p style="text-align:center; color:#555;">現在放送中</p>
</div>

<div id="backnumber" class="section">
    <h2>BACK NUMBER</h2>
    <div id="bn-list" class="grid">読み込み中...</div>
</div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyDoZtzHkOcC3p565fLN4oGO7vmlwQZiNkE",
        databaseURL: "https://club-d0011-default-rtdb.asia-southeast1.firebasedatabase.app",
        projectId: "club-d0011",
        appId: "1:51948793811:web:1edecab7c41c1d84ad8926"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    let player, currentId = "";

    function switchTab(id) {
        document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        if (id === 'backnumber') loadBacknumbers();
    }

    const tag = document.createElement('script');
    tag.src = "https://www.youtube.com/iframe_api";
    document.body.appendChild(tag);

    function onYouTubeIframeAPIReady() {
        player = new YT.Player('player', {
            playerVars: { 'autoplay': 1, 'controls': 1 },
            events: { 'onReady': () => {
                db.ref('sync').on('value', snap => {
                    const data = snap.val();
                    if (data && currentId !== data.videoId) {
                        player.loadVideoById({ videoId: data.videoId, startSeconds: data.time });
                        currentId = data.videoId;
                    }
                });
            }}
        });
    }

    function loadBacknumbers() {
        db.ref('backnumbers').orderByChild('timestamp').limitToLast(20).on('value', snap => {
            const list = document.getElementById('bn-list');
            list.innerHTML = "";
            snap.forEach(child => {
                const d = child.val();
                const div = document.createElement('div');
                div.className = "card";
                div.onclick = () => { player.loadVideoById(d.videoId); switchTab('top'); };
                div.innerHTML = `
                    <img src="https://img.youtube.com/vi/${d.videoId}/mqdefault.jpg">
                    <div class="card-info">${d.title}</div>`;
                list.prepend(div);
            });
        });
    }
</script>
</body>
</html>
