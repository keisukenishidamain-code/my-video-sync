<script>
    // ... (Firebase初期化部分は同じ) ...

    function onYouTubeIframeAPIReady() {
        livePlayer = new YT.Player('player-live', {
            playerVars: { 'autoplay': 1, 'controls': 0, 'disablekb': 1 } // リスナーは操作不可
        });
        
        // ★スタッフの操作を監視
        db.ref('sync').on('value', snap => {
            const data = snap.val();
            if (!data) return;

            // 1. 動画の切り替え
            if (currentLiveId !== data.videoId) {
                livePlayer.loadVideoById(id: data.videoId, startSeconds: data.time);
                currentLiveId = data.videoId;
            }

            // 2. 再生・停止の同期
            if (data.state === 1) livePlayer.playVideo();
            if (data.state === 2) livePlayer.pauseVideo();

            // 3. 時間のズレを強制補正（3秒以上ズレたらワープ）
            const diff = Math.abs(livePlayer.getCurrentTime() - data.time);
            if (diff > 3) {
                livePlayer.seekTo(data.time, true);
            }
        });
    }
    // ... (その他のタブ切り替え・アーカイブ処理) ...
</script>
